description "This is an upstart job file for Immutant"
 
# Ubuntu doesn't yet emit the network-services event:
# https://bugs.launchpad.net/ubuntu/+source/upstart/+bug/701576
#

start on started network-services
stop on stopping network-services
# respawn
 
limit nofile 4096 4096

env IMMUTANT_HOME=/var/lib/immutant/current
export IMMUTANT_HOME
env JBOSS_HOME=/var/lib/immutant/current/jboss
export JBOSS_HOME
env LAUNCH_JBOSS_IN_BACKGROUND=1
export LAUNCH_JBOSS_IN_BACKGROUND

script
bash << "EOF"
  su - immutant
  /var/lib/immutant/current/jboss/bin/standalone.sh -c standalone-ha.xml -b {{ ec2_private_ip_address }} -Djboss.port={{ immutant_port }} >> /var/log/immutant/immutant.log 2>&1
EOF
end script