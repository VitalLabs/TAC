description "This is an upstart job file for Immutant"
 
# Ubuntu doesn't yet emit the network-services event:
# https://bugs.launchpad.net/ubuntu/+source/upstart/+bug/701576
#

start on started network-services
stop on stopping network-services
# respawn
 
limit nofile 4096 4096

env IMMUTANT_HOME=/var/lib/immutant/current
export IMMUTANT_HOME
env JBOSS_HOME=/var/lib/immutant/current/jboss
export JBOSS_HOME
env LAUNCH_JBOSS_IN_BACKGROUND=1
export LAUNCH_JBOSS_IN_BACKGROUND


env JAVA_OPTS='%JAVA_OPTS% -Xms1024m -Xmx2048m -XX:MaxPermSize=512m'
export JAVA_OPTS


script
bash << "EOF"
  su - ubuntu
  /var/lib/immutant/current/jboss/bin/standalone.sh -c standalone-ha.xml -b {{ inventory_hostname }} -Djboss.port={{ switchboard_port }} >> /var/log/immutant/immutant.log 2>&1
EOF
end script