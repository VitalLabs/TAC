---
#NOTE:  PLaceholder until basics are hammered out:
- name: Need Facts
  hosts: dev_all
  remote_user: deploy
  sudo: true
  vars_files:
  - vars/main.yml

  tasks: []


- name: Rolling Updates
  hosts: dev_app
  remote_user: deploy
  sudo: true
  serial: 1  
  vars_files:
  - vars/main.yml
  
  # These are the tasks to run before applying updates:
  pre_tasks:

  - name: disable the server in haproxy
    shell: echo "disable server myapplb/{{ ansible_hostname }}" | socat stdio /var/lib/haproxy/stats
    delegate_to: "{{ item }}"
    with_items: dev_proxy

  roles:
  - app-deploy

  # These tasks run after the roles:
  post_tasks:
  - name: Enable the server in haproxy
    shell: echo "enable server myapplb/{{ ansible_hostname }}" | socat stdio /var/lib/haproxy/stats
    delegate_to: "{{ item }}"
    with_items: dev_proxy